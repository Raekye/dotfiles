
set exrc
set secure

set number
set ruler
set scrolloff=4

set hidden
set backspace=indent,eol,start
set autoread " update if changed externally and not modified locally
set nobackup " make backup before overwriting, and leave it around
set noswapfile " use swapfile for buffer

set encoding=utf-8
set ffs=unix,dos
set list
set listchars=tab:>\ ,eol:$ " tab before eol so trailing space doesn't get stripped
set listchars+=multispace:-,lead:-,trail:-
set listchars+=extends:>,precedes:<,conceal:!,nbsp:%
if v:version >= 900
	set listchars+=leadmultispace:\|---
else
endif
set conceallevel=0

set shiftwidth=4
set tabstop=4

set smartindent " less strict than cindent
set autoindent
set breakindent

set ignorecase
set smartcase
set incsearch " ctrl-g and ctrl-t to move to next and previous match

set showcmd
set laststatus=2 " always show status line for last window

set wildmenu " command line completion
if v:version >= 900
	set wildoptions=pum
endif

set ssop-=options
set ssop-=curdir
set ssop+=sesdir

set cscopequickfix=s-,g-,c-
set cscopetag

filetype on
syntax enable

let g:mapleader = ","

let g:markdown_recommended_style = 0
let g:python_recommended_style = 0

let g:NERDTreeShowLineNumbers = 1
let g:NERDTreeShowHidden = 1

let g:ctrlp_show_hidden = 1
let g:ctrlp_working_path_mode = 0 " set local working directory to pwd
let g:ctrlp_max_files = 0
if executable('ag')
	let g:ctrlp_user_command = 'ag -l --nocolor -g "" %s'
endif

let g:airline#extensions#tabline#enabled = 1
let g:airline_symbols_ascii = 1

if executable('ag')
	let g:ackprg = 'ag --vimgrep'
else
	let g:ackprg = 'grep --recursive --line-number'
endif

set omnifunc=ale#completion#OmniFunc
let g:ale_completion_enabled = 1
let g:ale_linters = { 'c': [], 'cpp': [], 'rust': ['analyzer'], }
let g:ale_fixers = { '*': ['remove_trailing_lines', 'trim_whitespace'] }
let g:ale_fix_on_save = 1
"let g:ale_virtualtext_cursor = 0

let g:gundo_prefer_python3 = 1

let g:rustfmt_autosave = 1
"let g:rustfmt_fail_silently = 1

call plug#begin('~/.vim/plugged')

Plug 'altercation/vim-colors-solarized'
Plug 'preservim/nerdtree'
Plug 'preservim/nerdcommenter'
Plug 'preservim/tagbar'
Plug 'ctrlpvim/ctrlp.vim'
Plug 'mileszs/ack.vim'
Plug 'dense-analysis/ale'
Plug 'tpope/vim-surround'
Plug 'tpope/vim-fugitive'
Plug 'tpope/vim-rails'
Plug 'tpope/vim-characterize'
Plug 'easymotion/vim-easymotion'
Plug 'vim-airline/vim-airline'
Plug 'vim-airline/vim-airline-themes'
Plug 'sjl/gundo.vim'
" https://github.com/junegunn/vim-plug/issues/1005
Plug 'airblade/vim-gitgutter', { 'branch': 'main' }
Plug 'rust-lang/rust.vim'

call plug#end()

let g:solarized_termcolors = 256
let g:solarized_visibility = "low"
set background=light
if isdirectory($HOME . '/.vim/plugged/vim-colors-solarized')
	colorscheme solarized
endif

" non-recursive mapmode-nvo
no Q <Nop>
no <C-n> :NERDTreeToggle<CR>
no <C-p> :CtrlP<CR>
no <C-l> :CtrlPBuffer<CR>
no <C-g> :TagbarToggle<CR>
no <C-h> <C-^>
no <C-c> :ccl<CR>:lcl<CR>
no <C-k> <Plug>(ale_previous_wrap)
no <C-j> <Plug>(ale_next_wrap)

" non-recursive mapmode-n
nn <leader>l :ls<CR>:buffer<space>
nn <leader>g :Ack!<space>
nn <leader>w :Gtags -s <C-R>=expand("<cword>")<CR><CR>
nn <leader>e :Gtags <C-R>=expand("<cword>")<CR><CR>
nn <leader>r :Gtags -r <C-R>=expand("<cword>")<CR><CR>
nn <leader>s :Gtags -s<space>
nn <leader>d :Gtags<space>
nn <leader>f :Gtags -r<space>
nn <leader>u :GundoToggle<CR>
" make 'n' and 'N' search direction agnostic of '/' and '?'
nn <expr> n 'Nn'[v:searchforward]
nn <expr> N 'nN'[v:searchforward]

" non-recursive mapmode-c
cno <expr> <c-n> wildmenumode() ? "\<C-n>" : "\<down>"
cno <expr> <c-p> wildmenumode() ? "\<C-p>" : "\<up>"
